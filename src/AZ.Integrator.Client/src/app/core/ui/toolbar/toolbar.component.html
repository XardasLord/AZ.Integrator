<mat-toolbar color="primary">
  <mat-toolbar-row>
    <button mat-icon-button (click)="toggleMenu()">
      <mat-icon>menu</mat-icon>
    </button>
    <span class="hidden lg:inline">AZ Integrator</span>

    <span class="spacer"></span>

    <mat-form-field class="mt-5 store-selector" *appRoleAllow="[AuthRoles.Admin]">
      <mat-label>Wybierz sklep</mat-label>

      <mat-select (selectionChange)="onSelected($event.value)">
        @for (group of tenantGroups; let first = $first; track group) {
          <!-- Nagłówek grupy jako nieklikalny wiersz -->
          <mat-option disabled class="!cursor-default !opacity-100 !py-0 !min-h-0">
            <ng-container *ngIf="!first">
              <div class="mt-3"></div>
            </ng-container>
            <div
              class="px-3 py-1.5 text-[12px] font-semibold tracking-wide uppercase text-slate-900 flex items-center gap-2 select-none">
              <span>{{ group.groupName }}</span>
              <span class="text-slate-800">({{ group.tenants.length }})</span>
            </div>
          </mat-option>

          <!-- Pozycje -->
          @for (tenant of group.tenants; track tenant) {
            <mat-option [value]="tenant" class="!py-0">
              <div class="flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-50 aria-selected:bg-slate-50">
                <!-- ikona / „avatar” platformy -->
                <div class="h-6 w-6 grid place-items-center rounded-md bg-slate-100 text-slate-600 shrink-0">
                  <mat-icon
                    [fontIcon]="iconFor(tenant.authorizationProvider)"
                    class="text-[18px] leading-none"></mat-icon>
                </div>

                <!-- nazwa + (opcjonalnie) podtytuł/login -->
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2">
                    <span class="truncate">{{ tenant.displayName }}</span>
                  </div>
                  <div *ngIf="tenant.subtitle" class="text-xs text-slate-400 truncate">
                    {{ tenant.subtitle }}
                  </div>
                </div>
              </div>
            </mat-option>
          }
        }
      </mat-select>
    </mat-form-field>

    <span class="right-section">
      <span class="section user-info">
        <span class="name"
          >{{ (user$ | async)?.firstName }} {{ (user$ | async)?.lastName }}
          <span class="hidden lg:inline">({{ (user$ | async)?.username }})</span></span
        >
      </span>

      <button mat-icon-button matTooltip="My Account">
        <mat-icon>account_circle</mat-icon>
      </button>

      <button mat-icon-button matTooltip="Wyloguj" (click)="logout()">
        <mat-icon class="material-icons-outlined">logout</mat-icon>
      </button>
    </span>
  </mat-toolbar-row>
</mat-toolbar>
