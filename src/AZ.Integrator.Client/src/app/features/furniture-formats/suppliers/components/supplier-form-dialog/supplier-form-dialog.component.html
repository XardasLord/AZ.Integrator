<div mat-dialog-title>
  <div class="flex justify-between items-center text-xl">
    <div class="flex items-center gap-3">
      <mat-icon class="text-primary">{{ editMode ? 'edit' : 'add_box' }}</mat-icon>
      <span>{{ editMode ? 'Edytuj dostawcę' : 'Nowy dostawca' }}</span>
    </div>
    <mat-icon class="cursor-pointer hover:text-red-600 transition-colors" mat-dialog-close>close</mat-icon>
  </div>
</div>

<mat-divider />

<div mat-dialog-content>
  <form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div class="form-section mt-4">
      <mat-form-field class="w-full">
        <mat-label>
          <mat-icon class="align-middle mr-1 text-sm">business</mat-icon>
          Nazwa dostawcy
        </mat-label>
        <input type="text" matInput formControlName="name" />
        <mat-icon matPrefix class="text-gray-500">store</mat-icon>
        @if (form.controls.name.hasError('required')) {
          <mat-error> Nazwa dostawcy jest wymagana </mat-error>
        }
        @if (form.controls.name.hasError('minlength')) {
          <mat-error> Nazwa musi mieć co najmniej 1 znak </mat-error>
        }
      </mat-form-field>

      <mat-form-field class="w-full">
        <mat-label> Numer telefonu (opcjonalnie) </mat-label>
        <input type="tel" matInput formControlName="telephoneNumber" />
        <mat-icon matPrefix class="text-gray-500">call</mat-icon>
      </mat-form-field>
    </div>

    <mat-divider class="my-4" />

    <div class="section-header">
      <mat-icon class="section-icon">email</mat-icon>
      <div class="section-title">Adresy email</div>
      <button
        mat-raised-button
        color="primary"
        type="button"
        (click)="addMailbox()"
        matTooltip="Dodaj nowy adres email">
        <mat-icon>add</mat-icon>
        Dodaj email
      </button>
    </div>

    @if (mailboxes.length === 0) {
      <div class="empty-state">
        <mat-icon>email</mat-icon>
        <div class="empty-text">Brak adresów email. Dodaj co najmniej jeden adres email.</div>
      </div>
    }

    <div formArrayName="mailboxes" class="mailboxes-list">
      @for (_ of mailboxes.controls; track _; let i = $index) {
        <mat-card class="mailbox-card mb-3">
          <mat-card-header class="mailbox-card-header">
            <mat-card-title class="text-base">
              <span class="mailbox-number-badge">{{ i + 1 }}</span>
              Email {{ i + 1 }}
            </mat-card-title>
            <button
              mat-icon-button
              type="button"
              (click)="removeMailbox(i)"
              matTooltip="Usuń adres email"
              class="delete-button"
              [disabled]="mailboxes.length === 1">
              <mat-icon class="!text-red-600">delete</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content [formGroupName]="i">
            <mat-form-field class="w-full">
              <mat-label>Adres email</mat-label>
              <input type="email" matInput formControlName="email" />
              <mat-icon matPrefix class="text-gray-500">alternate_email</mat-icon>
              @if (mailboxes.controls[i].get('email')?.hasError('required')) {
                <mat-error>
                  Adres email jest wymagany
                </mat-error>
              }
              @if (mailboxes.controls[i].get('email')?.hasError('email')) {
                <mat-error>
                  Nieprawidłowy format adresu email
                </mat-error>
              }
            </mat-form-field>
            <input type="hidden" formControlName="id" />
          </mat-card-content>
        </mat-card>
      }
    </div>
  </form>
</div>

<mat-divider />

<div mat-dialog-actions align="end">
  <button mat-flat-button [disabled]="form.invalid" color="primary" (click)="onSubmit()">
    <mat-icon>save</mat-icon>
    Zapisz dostawcę
  </button>
  <button mat-stroked-button color="primary" mat-dialog-close (click)="onCancel()">
    <mat-icon>cancel</mat-icon>
    Anuluj
  </button>
</div>
