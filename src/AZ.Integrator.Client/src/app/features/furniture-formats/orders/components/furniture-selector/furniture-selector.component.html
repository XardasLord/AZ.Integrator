<div class="furniture-selector">
  <div class="selector-info">
    <p class="info-text">
      Wybrano: <strong>{{ selectedDefinitions.length }}</strong> definicji mebli
    </p>
  </div>

  <!-- Search Bar -->
  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Szukaj definicji mebli</mat-label>
    <input matInput [(ngModel)]="searchText" (ngModelChange)="onSearchChange()" placeholder="Wpisz kod mebla..." />
    <mat-icon matPrefix>search</mat-icon>
    @if (searchText) {
      <button
        mat-icon-button
        matSuffix
        (click)="searchText = ''; onSearchChange()"
        aria-label="Wyczyść">
        <mat-icon>close</mat-icon>
      </button>
    }
  </mat-form-field>

  <!-- Results Info -->
  @if (filteredDefinitions.length > 0) {
    <div class="results-info">
      <p class="info-text">
        Znaleziono: <strong>{{ filteredDefinitions.length }}</strong> definicji
      </p>
    </div>
  }

  <div class="furniture-grid">
    @for (definition of pagedDefinitions; track definition) {
      <mat-card
        class="furniture-card"
        [class.selected]="isSelected(definition)"
        (click)="toggleSelection(definition)">
        <mat-card-content>
          <div class="card-header">
            <mat-checkbox
              [checked]="isSelected(definition)"
              (click)="$event.stopPropagation()"
            (change)="toggleSelection(definition)"></mat-checkbox>
            <h4 class="furniture-code">{{ getDefinitionDisplay(definition) }}</h4>
          </div>
          <div class="card-details">
            <div class="detail-item">
              <mat-icon class="detail-icon">view_module</mat-icon>
              <span>{{ getPartCount(definition) }} formatek</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    }
  </div>

  <!-- Paginator -->
  @if (filteredDefinitions.length > pageSize) {
    <mat-paginator
      [length]="filteredDefinitions.length"
      [pageSize]="pageSize"
      [pageIndex]="currentPage"
      [pageSizeOptions]="[10, 25, 50, 100]"
      (page)="onPageChange($event)"
      showFirstLastButtons>
    </mat-paginator>
  }

  @if (!furnitureDefinitions || furnitureDefinitions.length === 0) {
    <div class="empty-state">
      <mat-icon class="empty-icon">inventory_2</mat-icon>
      <p>Brak dostępnych definicji mebli</p>
    </div>
  }

  @if (filteredDefinitions.length === 0 && searchText) {
    <div class="empty-state">
      <mat-icon class="empty-icon">search_off</mat-icon>
      <p>Nie znaleziono definicji pasujących do: "{{ searchText }}"</p>
    </div>
  }
</div>
