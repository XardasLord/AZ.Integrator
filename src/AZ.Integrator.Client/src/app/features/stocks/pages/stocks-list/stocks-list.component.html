<div class="p-6 bg-gray-50 rounded-xl shadow-lg">
  <mat-accordion>
    <ng-container *ngIf="groups$ | async as groups">
      <ng-container *ngIf="connectedDropLists$ | async as connectedDropLists">
        <ng-container *ngFor="let group of groups; trackBy: trackByGroupId">
          <div
            cdkDropList
            [id]="'group-' + group.id"
            [cdkDropListConnectedTo]="connectedDropLists"
            [cdkDropListData]="group.stocks"
            (cdkDropListDropped)="onDropPackageCodeToGroup($event, group.id)"
            class="mb-4">
            <mat-expansion-panel
              class="rounded-lg shadow border border-gray-200"
              [ngClass]="hasWarning(group) ? '!bg-gradient-to-r !from-orange-100 !to-orange-200' : ''">
              <mat-expansion-panel-header>
                <div class="flex items-center justify-between w-full">
                  <div>
                    <div class="flex items-center gap-3">
                      <span class="font-semibold text-lg text-gray-700">
                        {{ group.name }}
                      </span>
                      <span
                        class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        {{ group.stocks.length }}
                      </span>
                      <mat-icon
                        *ngIf="hasWarning(group)"
                        class="!text-orange-500 text-base"
                        matTooltip="W grupie są kody poniżej progu">
                        warning
                      </mat-icon>
                    </div>
                    <span class="text-sm text-gray-400">{{ group.description }}</span>
                  </div>
                  <button mat-icon-button (click)="editGroup(group)" [matTooltip]="'Edytuj grupę'" class="shrink-0">
                    <mat-icon>edit</mat-icon>
                  </button>
                </div>
              </mat-expansion-panel-header>

              <div
                class="grid gap-4 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 p-4 bg-gray-50 rounded-lg">
                <ng-container *ngIf="group.stocks && group.stocks.length > 0; else noStocks">
                  <ng-container *ngFor="let stock of group.stocks; trackBy: trackByStockCode">
                    <div
                      cdkDrag
                      [ngClass]="{
                        '!bg-gradient-to-r !from-orange-50 !to-orange-100': hasQuantityBelowThreshold(stock),
                      }"
                      class="bg-white border border-gray-200 rounded-lg shadow-sm p-4 flex flex-col gap-2 hover:shadow-md transition-shadow cursor-grab active:cursor-grabbing">
                      <div class="flex items-center justify-between">
                        <span class="font-medium text-gray-700 text-base">{{ stock.packageCode }}</span>
                        <mat-icon
                          *ngIf="hasQuantityBelowThreshold(stock)"
                          class="!text-orange-500"
                          matTooltip="Mało towaru">
                          warning
                        </mat-icon>
                      </div>
                      <div class="flex items-center justify-between mt-2">
                        <span
                          class="inline-flex items-center px-2 py-0.5 rounded-full text-s font-medium"
                          [ngClass]="{
                            'text-orange-500 bg-orange-100': hasQuantityBelowThreshold(stock),
                            'text-green-600 bg-green-100': !hasQuantityBelowThreshold(stock),
                          }">
                          {{ stock.quantity }}
                        </span>
                        <mat-icon class="text-gray-300 ml-2">drag_indicator</mat-icon>
                      </div>
                    </div>
                  </ng-container>
                </ng-container>
              </div>

              <ng-template #noStocks>
                <div class="flex flex-col items-center justify-center text-gray-400 py-8">
                  <mat-icon class="mb-2 text-4xl">inventory_2</mat-icon>
                  <span class="text-base">Brak kodów w tej grupie.</span>
                </div>
              </ng-template>
            </mat-expansion-panel>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </mat-accordion>
</div>
